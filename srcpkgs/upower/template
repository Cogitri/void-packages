# Template file for 'upower'
pkgname=upower
version=0.99.9
revision=1
_release_sha=2282c7c0e53fb31816b824c9d1f547e8
build_style=gnu-configure
configure_args="--disable-static --with-backend=linux"
hostmakedepends="pkg-config intltool libxslt docbook-xsl $(vopt_if gir gobject-introspection)"
makedepends="libusb-devel libgudev-devel dbus-glib-devel libimobiledevice-devel polkit-devel"
conf_files="/etc/UPower/UPower.conf"
short_desc="Abstraction for enumerating power devices"
maintainer="Rasmus Thomsen <rasmus.thomsen@protonmail.com>"
license="GPL-2.0-or-later"
homepage="https://upower.freedesktop.org"
# upstream doesn't update the relase tarballs :c
distfiles="https://gitlab.freedesktop.org/upower/upower/uploads/${_release_sha}/upower-${version}.tar.xz"
checksum=01ba89469bb6ed835a602909dbf987f2652d273286948d36f3675578e4e9d110

provides="upower0-${version}_${revision}"
replaces="upower0>=0"

# Package build options
build_options="gir"
# Disable gir for cross builds.
if [ -z "$CROSS_BUILD" ]; then
	build_options_default="gir"
fi

libupower-glib3_package() {
	short_desc+=" - runtime library"
	pkg_install() {
		vmove usr/lib/*.so.*
	}
}
upower-devel_package() {
	provides="upower0-devel-${version}_${revision}"
	replaces="upower0-devel>=0"
	depends="dbus-glib-devel libupower-glib3>=${version}_${revision}"
	short_desc+=" - development files"
	pkg_install() {
		vmove usr/include
		vmove usr/lib/pkgconfig
		if [ "$build_option_gir" ]; then
			vmove usr/share/gir-1.0
		fi
		vmove "usr/lib/*.so"
	}
}
